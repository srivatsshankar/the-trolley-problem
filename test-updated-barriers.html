<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Updated Barriers Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        #canvas {
            border: 1px solid #ccc;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Updated Barriers Test</h1>
        <p>Testing the updated barrier system with:</p>
        <ul>
            <li>Trolley barriers that match the main trolley model (no flickering, no smoke, grey windows)</li>
            <li>Trolley barriers in random colors: blue, green, yellow, orange</li>
            <li>Light grey/silver rocks that stand out on tracks</li>
            <li>No buffer obstacles (removed)</li>
        </ul>
        
        <div class="test-section">
            <h3>Visual Test</h3>
            <canvas id="canvas" width="800" height="400"></canvas>
            <div>
                <button onclick="testTrolleyBarriers()">Test Trolley Barriers</button>
                <button onclick="testRockBarriers()">Test Rock Barriers</button>
                <button onclick="testRandomBarriers()">Test Random Barriers</button>
                <button onclick="clearScene()">Clear Scene</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>Test Log</h3>
            <div id="log"></div>
        </div>
    </div>

    <script type="module">
        import * as THREE from './node_modules/three/build/three.module.js';
        import { createObstacle, createRandomObstacle, TROLLEY_BARRIER_COLORS } from './dist/models/Obstacle.js';

        let scene, camera, renderer;
        let obstacles = [];

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function initScene() {
            const canvas = document.getElementById('canvas');
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Sky blue
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
            camera.position.set(0, 5, 10);
            camera.lookAt(0, 0, 0);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ canvas: canvas });
            renderer.setSize(canvas.width, canvas.height);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Ground plane
            const groundGeometry = new THREE.PlaneGeometry(20, 20);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Railway tracks for context
            addRailwayTracks();
            
            log('Scene initialized successfully');
        }

        function addRailwayTracks() {
            // Add simple railway tracks for visual context
            const trackMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            // Left rail
            const leftRailGeometry = new THREE.BoxGeometry(0.1, 0.2, 15);
            const leftRail = new THREE.Mesh(leftRailGeometry, trackMaterial);
            leftRail.position.set(-0.7, 0.1, 0);
            scene.add(leftRail);
            
            // Right rail
            const rightRailGeometry = new THREE.BoxGeometry(0.1, 0.2, 15);
            const rightRail = new THREE.Mesh(rightRailGeometry, trackMaterial);
            rightRail.position.set(0.7, 0.1, 0);
            scene.add(rightRail);
            
            // Ties
            for (let i = -7; i <= 7; i += 2) {
                const tieGeometry = new THREE.BoxGeometry(2, 0.15, 0.3);
                const tie = new THREE.Mesh(tieGeometry, trackMaterial);
                tie.position.set(0, 0.075, i);
                scene.add(tie);
            }
        }

        function clearScene() {
            obstacles.forEach(obstacle => {
                scene.remove(obstacle.getGroup());
                obstacle.dispose();
            });
            obstacles = [];
            log('Scene cleared');
            render();
        }

        function render() {
            renderer.render(scene, camera);
        }

        window.testTrolleyBarriers = function() {
            log('Testing trolley barriers with different colors...');
            clearScene();
            
            try {
                const colors = ['Blue', 'Green', 'Yellow', 'Orange'];
                const colorValues = TROLLEY_BARRIER_COLORS;
                
                for (let i = 0; i < colors.length; i++) {
                    const position = new THREE.Vector3((i - 1.5) * 3, 0, -2);
                    const obstacle = createObstacle('trolley', position, {
                        colors: { primary: colorValues[i] }
                    });
                    
                    scene.add(obstacle.getGroup());
                    obstacles.push(obstacle);
                    
                    log(`✓ Created ${colors[i]} trolley barrier at position (${position.x}, ${position.y}, ${position.z})`);
                }
                
                log('✓ All trolley barriers created successfully');
                render();
                
            } catch (error) {
                log('✗ Error creating trolley barriers: ' + error.message);
            }
        };

        window.testRockBarriers = function() {
            log('Testing light grey/silver rock barriers...');
            clearScene();
            
            try {
                for (let i = 0; i < 4; i++) {
                    const position = new THREE.Vector3((i - 1.5) * 3, 0, 2);
                    const obstacle = createObstacle('rock', position);
                    
                    scene.add(obstacle.getGroup());
                    obstacles.push(obstacle);
                    
                    log(`✓ Created light grey rock barrier at position (${position.x}, ${position.y}, ${position.z})`);
                }
                
                log('✓ All rock barriers created successfully');
                render();
                
            } catch (error) {
                log('✗ Error creating rock barriers: ' + error.message);
            }
        };

        window.testRandomBarriers = function() {
            log('Testing random barrier generation (no buffers)...');
            clearScene();
            
            try {
                for (let i = 0; i < 6; i++) {
                    const position = new THREE.Vector3((i - 2.5) * 2.5, 0, 0);
                    const obstacle = createRandomObstacle(position);
                    
                    scene.add(obstacle.getGroup());
                    obstacles.push(obstacle);
                    
                    log(`✓ Created random ${obstacle.type} barrier at position (${position.x}, ${position.y}, ${position.z})`);
                }
                
                log('✓ All random barriers created successfully (only rocks and trolleys)');
                render();
                
            } catch (error) {
                log('✗ Error creating random barriers: ' + error.message);
            }
        };

        // Initialize when page loads
        window.addEventListener('load', () => {
            initScene();
            render();
        });
    </script>
</body>
</html>